# 目录
[toc]



# [一.文件存储](# 目录)
- 文件存储是Android中最基本的一种存储方式，可以将需要存储的数据保存到文件中，再读出来。保存的文件在手机内置的文件管理器中是不可见的，只能通过代码的方式，在需要的时候将数据读出来，文件存储方法不需要申请文件读写权限。

## 存数据
- 首先通过 `openFileOutput(name, mode)` 方法生成一个 `FileOutputStream`对象，找到对应文件并转成文件输出流。其中 `name` 时文件名，`mode` 是写文件的模式，目前写文件有两种模式：`MODE_PRIVATE` 和 `MODE_APPEND`，分别对应覆盖原文件内容和在原文件后续写。同时，文件将保存在 `/data/data/<package name>/files` 目录下。 接着用 `new BufferedWriter(OutputStreamWriter)` 方法初始化一个写者，该写者的作用是将数据写入文件，其中 `OutputStreamWriter`对象通过构造函数 `new OutputStreamWriter(FileOutputStream)` 得到，这一步的作用是将写者与文件对应起来。最后，用 `BufferedWriter.write(data)` 方法将数据写入文件。
- 写完之后，我们还需将 `BufferedWriter` 对象关闭，关闭时首先要判断该写者是否存在，只有存在才能关闭。

```java
	public void save()
    {
        String content = editText.getText().toString();

        FileOutputStream fileOutputStream = null;
        BufferedWriter writer = null;

        try
        {
            //MODE_PRIVATE表示覆盖原文件中的内容， MODE_APPEND表示在源文件后面继续添加
            fileOutputStream = openFileOutput("data.txt", Context.MODE_PRIVATE);
            writer = new BufferedWriter(new OutputStreamWriter(fileOutputStream));
            writer.write(content);

        }catch (IOException e)
        {
            e.printStackTrace();
        }
        finally {
            try {
                if (writer != null)
                {
                    Log.d("writer","不为空");
                    writer.close();
                }

            }catch (IOException e)
            {
                e.printStackTrace();
            }
        }
    }
```

- Android Studio在Device Explorer模块中提供了查看文件的功能，该模块在整个界面的右下角。通过该功能可以看到文件已经被建立，并且内容也写了进去。

  ![image-20200805154316914](C:\Users\pgj\AppData\Roaming\Typora\typora-user-images\image-20200805154316914.png)

## 读数据
- 读数据的过程与写数据类似，首先通过 `OpenFileInput(name)` 方法生成一个目标文件的读入流 `FileInputStream inputStream`，接着用 `new BufferedReader(new InputStreamReader(inputStream))` 方法生成一个读者，最后将数据读出即可。由于在读文件的过程中是一行一行读的，如果想将所有内容变成一段String类型，则需要定义一个StringBuilder类，在读取文件行时将内容存储进去。最后通过 `StringBuilder.toString()` 方法得到全部内容的String形式。与写者一样，读者也需要close，保证数据不会泄露。

```java
	public void read()
    {
        FileInputStream inputStream = null;
        BufferedReader reader = null;
        StringBuilder content = new StringBuilder();

        try
        {
            inputStream = openFileInput("data.txt");
            reader = new BufferedReader(new InputStreamReader(inputStream));
            String line = "";

            while ((line = reader.readLine()) != null)
            {
                content.append(line);
            }
        }catch (IOException e)
        {
            e.printStackTrace();
        }
        finally {
            try
            {
                if (reader != null)
                {
                    reader.close();
                }
            }catch (IOException e)
            {
                e.printStackTrace();
            }
        }
        Toast.makeText(this, content.toString(), Toast.LENGTH_SHORT).show();
    }
```

<img src="C:\Users\pgj\AppData\Roaming\Typora\typora-user-images\image-20200805160035630.png" alt="image-20200805160035630" style="zoom:67%;" />



# [二.SharedPreference存储](# 目录)
- SharedPreference通过键值对进行存储和读取，与文件存储一样，在保存数据使也会生成一个文件，但该文件是.xml形式的文件，也无法手机的文件管理器中直接看到，但是可以通过Android Studio的Device Explorer功能找到。文件的保存位置在 `/data/data/<package name>/shared_prefs` 目录下。

## 存数据
- 存数据时，我们首先要建立一个 `SharedPreference` 对象，这个对象不用声明，直接通过调用 `getSharedPreference(name, mode)` 方法即可。其中 `name` 是这个对象的名称，同时也是保存数据的.xml文件的名称，如果该文件不存在，系统会自动创建。接着需要通过 `SharedPreference.editor` 对象进行存储，`editor` 对象提供 `putString`，`putInt` 等方法，存储String，Int等类型的数据。最后，通过 `editor.apply()`方法提交操作，完成数据的保存。

```java
	public void sharedPreferenceSave()
    {
        SharedPreferences.Editor editor = getSharedPreferences("data", MODE_PRIVATE).edit();
        editor.putString("name", "pgj");
        editor.putInt("age", 23);
        editor.apply();
    }
```

![image-20200805161640423](C:\Users\pgj\AppData\Roaming\Typora\typora-user-images\image-20200805161640423.png)

## 读数据
- 通过SharedPreference对象读数据只需要通过名称找到对应的文件，并通过 `getString()`，`getInt()` 等方法读取数据即可。

```java
	public void sharedPreferenceGet()
    {
        SharedPreferences preferences = getSharedPreferences("data", MODE_PRIVATE);
        String name = preferences.getString("name", "");
        int age = preferences.getInt("age", 0);
        Toast.makeText(this, name+" "+age, Toast.LENGTH_SHORT).show();
    }
```

<img src="C:\Users\pgj\AppData\Roaming\Typora\typora-user-images\image-20200805161906747.png" alt="image-20200805161906747" style="zoom:67%;" />